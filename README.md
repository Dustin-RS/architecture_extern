# üß© –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã (UML-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **7 –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤**, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é —á–∞—Å—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞.

–ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≥—Ä—É–ø–ø–æ–π –∫–ª–∞—Å—Å–æ–≤ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ —á—ë—Ç–∫–∏–µ UML-—Å–≤—è–∑–∏:

* **–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (generalization)** ‚Äî —Å—Ç—Ä–µ–ª–∫–∞ —Å –ø—É—Å—Ç—ã–º —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–º
* **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (realization)** ‚Äî –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ —Å –ø—É—Å—Ç—ã–º —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–º
* **–ê–≥—Ä–µ–≥–∞—Ü–∏—è** ‚Äî –ø—É—Å—Ç–æ–π —Ä–æ–º–±
* **–ö–æ–º–ø–æ–∑–∏—Ü–∏—è** ‚Äî –∑–∞–∫—Ä–∞—à–µ–Ω–Ω—ã–π —Ä–æ–º–±
* **–ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è** ‚Äî –æ–±—ã—á–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞
* **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** ‚Äî –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞

–ù–∏–∂–µ ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏.

---

# üì¶ 1. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `catalog`: —Ç–æ–≤–∞—Ä—ã –∏ —Ñ–∞–±—Ä–∏–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

`catalog` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
–ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞ (Abstract Factory)**, —á—Ç–æ–±—ã –∫–∞–∂–¥–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–º–µ–ª–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —Å–æ–∑–¥–∞–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –º–∞–ø–ø–∏–Ω–≥–∞ –∏–Ω–¥–µ–∫—Å–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

* **`AbstractProduct` (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å)**
  –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Ç–æ–≤–∞—Ä–∞. –ü–æ–ª—è:

  * `id: UUID`
  * `title: String`
  * `price: Money`

  –ú–µ—Ç–æ–¥—ã:

  * `validate()` ‚Äî –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏.

* **–ù–∞—Å–ª–µ–¥–Ω–∏–∫–∏:**

  * `ElectronicProduct`
  * `ClothingProduct`
  * `BookProduct`
    –í—Å–µ –æ–Ω–∏ *–Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è* –æ—Ç `AbstractProduct`.

**UML:**
`AbstractProduct <|-- ElectronicProduct`

---

### –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

* **`ICategoryFamilyFactory` (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)**
  –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–µ–º–µ–π—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

  –ú–µ—Ç–æ–¥—ã:

  * `create_product(attrs: Map): AbstractProduct`
  * `create_validator(): IValidator`
  * `create_index_mapper(): IIndexMapper`

* –ö–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç **—Å–≤–æ—è —Ñ–∞–±—Ä–∏–∫–∞**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

  * `ElectronicsFamilyFactory`
  * `ClothingFamilyFactory`

–û–Ω–∏ **—Ä–µ–∞–ª–∏–∑—É—é—Ç** –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ–∞–±—Ä–∏–∫–∏.

**UML:**
`ICategoryFamilyFactory <|.. ElectronicsFamilyFactory`

---

### –†–µ–µ—Å—Ç—Ä —Ñ–∞–±—Ä–∏–∫

* **`CategoryRegistry`**
  –ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è: `CategoryRegistry --> ICategoryFamilyFactory`

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ –∫–æ–¥—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ—Å—Ç–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ–∞–±—Ä–∏–∫—É.

### –ü—Ä–∏–º–µ—Ä

> –ü—Ä–æ–¥–∞–≤–µ—Ü –¥–æ–±–∞–≤–ª—è–µ—Ç 200 —Ç–µ—Ç—Ä–∞–¥–µ–π (A4, –∫–ª–µ—Ç–∫–∞, 2 —Ä—É–±–ª—è).
> –°–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç:
>
> ```
> factory = registry.getFactory("stationery")
> product = factory.create_product({size: "A4", pattern: "grid", price: 2})
> product.validate()
> ```

–¢–∞–∫ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–≤–∞—Ä—ã —Ä–∞–∑–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

---

# üå≤ 2. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `catalog.tree`: –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–≠—Ç–æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∫–æ–º–ø–æ–Ω–æ–≤—â–∏–∫ (Composite pattern)**.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

* **`CategoryComponent` (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π)**
  –ú–µ—Ç–æ–¥—ã:

  * `getName()`
  * `getChildren()`

* **`CategoryLeaf`**
  –õ–∏—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´–ù–æ—É—Ç–±—É–∫–∏¬ª)

* **`CategoryComposite`**
  –í–µ—Ç–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞¬ª)
  **–ö–æ–º–ø–æ–∑–∏—Ü–∏—è:**
  `CategoryComposite *-- CategoryComponent`
  –ü–æ—Ç–æ–º—É —á—Ç–æ children –∂–∏–≤—É—Ç –≤–Ω—É—Ç—Ä–∏ CategoryComposite.

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω?

–ß—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:

```
–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
 ‚îú‚îÄ‚îÄ –ú–æ–±–∏–ª—å–Ω—ã–µ
 ‚îî‚îÄ‚îÄ –ù–æ—É—Ç–±—É–∫–∏
–ö–Ω–∏–≥–∏
 ‚îú‚îÄ‚îÄ –§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞
 ‚îî‚îÄ‚îÄ –£—á–µ–±–Ω–∏–∫–∏
```

---

# üìë 3. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `listings`: –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ / —Ä–∞–±–æ—Ç–∞ —Å –ë–î

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

`listings` ‚Äî —ç—Ç–æ —Å–ª–æ–π –º–µ–∂–¥—É –¥–æ–º–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ –ë–î.
–ó–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Repository Pattern**.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

* **`ListingService`**
  –ú–µ—Ç–æ–¥—ã:

  * `create_listing(dto: ListingDTO)`
  * `get_listing(id: UUID)`

  –ê—Å—Å–æ—Ü–∏–∞—Ü–∏–∏:

  * `ListingService --> IListingRepository`
  * `ListingService ..> ICategoryFamilyFactory`

* **`ListingDTO`**
  –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç: `{seller_id, attrs, category_code, price, ‚Ä¶}`
  DTO **–Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è**, –ª–∏—à—å –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ.

* **`IListingRepository` (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)**

  * `save(listing)`
  * `find(id)`

* **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:**

  * `ListingRepository` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –ë–î
  * `ListingRepositoryCacheProxy` ‚Äî –∫–µ—à–∏—Ä—É—é—â–∏–π –ø—Ä–æ–∫—Å–∏
    –ê–≥—Ä–µ–≥–∞—Ü–∏—è:
    `ListingRepositoryCacheProxy o-- ListingRepository`

### –ü—Ä–∏–º–µ—Ä

```
product = factory.create_product(attrs)
listing = Listing(product, seller_id)
repository.save(listing)
```

---

# üì¶ 4. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `orders`: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤

–°–∞–º—ã–π –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

* **Builder** ‚Äî —Å–±–æ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞
* **State** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–∫–∞–∑–∞
* **Chain of Responsibility** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫–∞–∑–∞
* **Command** ‚Äî –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø–ª–∞—Ç–∏—Ç—å / –æ—Ç–º–µ–Ω–∏—Ç—å)

---

## Builder

* **`IOrderBuilder`**
* **`ConcreteOrderBuilder`**

–ú–µ—Ç–æ–¥—ã:

```
with_items()
with_buyer()
with_shipping()
build(): Order
```

–ü—Ä–∏–º–µ—Ä:

```
order = builder.with_items([item1, item2])
               .with_buyer(user)
               .build()
```

---

## Order / Context / States

* **`Order`**
  –ü–æ–ª—è:

  * `id`
  * `items`
  * `total`

* **`OrderState` (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π)**

  * `pay(context)`
  * `cancel(context)`

* –ù–∞—Å–ª–µ–¥–Ω–∏–∫–∏:

  * `CreatedState`
  * `PaidState`
  * `ReservedState`
  * `ShippedState`
  * `CancelledState`

**–ö–æ–º–ø–æ–∑–∏—Ü–∏—è:**
`OrderContext *-- OrderState`

**–ü—Ä–∏–º–µ—Ä —Ä–∞–∑–Ω–∏—Ü—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π:**

* `CreatedState.pay()` ‚Üí –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ `PaidState`
* `PaidState.cancel()` ‚Üí –∑–∞–ø—Ä–µ—â–µ–Ω–æ
* `ShippedState.pay()` ‚Üí —É–∂–µ –ø–æ–∑–¥–Ω–æ

---

## Chain of Responsibility

* `OrderHandler` (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π)
* –ù–∞—Å–ª–µ–¥–Ω–∏–∫–∏:

  * `CartValidationHandler`
  * `StockReservationHandler`
  * `PaymentValidationHandler`
  * `FraudCheckHandler`

–ö–∞–∂–¥—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç `next.handle()` –µ—Å–ª–∏ –≤—Å—ë –æ–∫.

---

## Commands

* `ICommand`
* `PlaceOrderCommand`
* `CapturePaymentCommand`
* `CommandBus` (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥)

–ü—Ä–∏–º–µ—Ä:

```
bus.execute(new CapturePaymentCommand(orderId))
```

---

# üí≥ 5. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `payments`: –æ–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–æ–≤

–°–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–µ —Ä–∞–∑–Ω—ã–µ –≥—Ä—É–ø–ø—ã –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:

### 1) –°—Ç—Ä–∞—Ç–µ–≥–∏—è (Strategy)

**`IPaymentStrategy`**

* `StripeStrategy`
* `PayPalStrategy`
* `BankStrategy`

–û–ø—Ä–µ–¥–µ–ª—è—é—Ç **–ª–æ–≥–∏–∫—É –æ–ø–ª–∞—Ç—ã**.

### 2) –ê–¥–∞–ø—Ç–µ—Ä—ã (Adapter)

**`IPaymentGateway`**

* `StripeAdapter`
* `PayPalAdapter`
* `BankAdapter`

–ü–æ–¥–∫–ª—é—á–∞—é—Ç –≤–Ω–µ—à–Ω–∏–µ API –±–∞–Ω–∫–æ–≤.

### –í–æ–ø—Ä–æ—Å: –ø–æ—á–µ–º—É –Ω—É–∂–Ω—ã –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∏ –≥–µ–π—Ç–≤–µ–∏?

–ü–æ—Ç–æ–º—É —á—Ç–æ:

* **Gateway** ‚Äì —É–Ω–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç API —Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
* **Strategy** ‚Äì –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –æ–ø–ª–∞—Ç—ã (–∫–æ–≥–¥–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞ —Å–ø–∏—Å—ã–≤–∞—Ç—å, –∫–æ–≥–¥–∞ –æ—Ç–º–µ–Ω—è—Ç—å)

–°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç gateway:

```
gateway.authorize(amount)
gateway.capture(transaction_id)
```

–†–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ, –Ω–æ –¥–µ–ª–∞—é—Ç —Ä–∞–∑–Ω–æ–µ.

---

# üîî 6. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `events`: —Å–æ–±—ã—Ç–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ **EventBus** –∏ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç —Å–ª–∞–±—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:

* `IEvent` ‚Äî –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–±—ã—Ç–∏—è

* `OrderPlacedEvent` ‚Äî —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

* `IEventHandler` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

* –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:

  * `EmailNotifier`
  * `SellerNotifier`
  * `AnalyticsHandler`

* `EventBus`
  –ê–≥—Ä–µ–≥–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
  `EventBus o-- IEventHandler`

### –í–æ–ø—Ä–æ—Å: –∑–∞—á–µ–º –Ω—É–∂–µ–Ω OrderPlacedEvent?

–ß—Ç–æ–±—ã:

* —É–≤–µ–¥–æ–º–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–∞
* –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ
* –æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
* –Ω–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å—ã

**–ë–µ–∑ –∂—ë—Å—Ç–∫–æ–π —Å–≤—è–∑–∏ —Å orders, pricing, analytics.**

---

# üí∞ 7. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å `pricing`: —Ä–∞—Å—á—ë—Ç —Ü–µ–Ω—ã

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **Decorator Pattern**.

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

* `IPriceCalculator`

  * –º–µ—Ç–æ–¥ `calculate(listing, ctx)`

### –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* `BasePriceCalculator` ‚Äî –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
* –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã:

  * `PromotionDecorator`
  * `TaxDecorator`
  * `LoyaltyDecorator`

–ö–∞–∂–¥—ã–π **–æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç** –¥—Ä—É–≥–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä.

**UML:**
`PromotionDecorator --> IPriceCalculator` *(–∞–≥—Ä–µ–≥–∞—Ü–∏—è)*

### –ü—Ä–∏–º–µ—Ä

```
calc = new LoyaltyDecorator(
          new TaxDecorator(
              new PromotionDecorator(
                  new BasePriceCalculator()
              )
          )
      )

final_price = calc.calculate(listing)
```

---

# ‚ùì –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ


### 1) –ó–∞—á–µ–º –Ω—É–∂–µ–Ω ListingDTO?

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ ‚Üí —Å–µ—Ä–≤–∏—Å–∞ ‚Üí —Ñ–∞–±—Ä–∏–∫–∏
**–Ω–µ —Å–æ–∑–¥–∞–≤–∞—è –¥–æ–º–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –Ω–∞–ø—Ä—è–º—É—é**.

DTO ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö (Data Transfer Object).

---

### 2) –ß–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è OrderState?

–ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:

* –ú–æ–∂–Ω–æ –ª–∏ –æ–ø–ª–∞—Ç–∏—Ç—å
* –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å
* –ö–∞–∫ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

`CreatedState.pay()` ‚Üí `PaidState`
`PaidState.cancel()` ‚Üí –Ω–µ–ª—å–∑—è
`ShippedState.pay()` ‚Üí –Ω–µ—Ç —Å–º—ã—Å–ª–∞

–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω **State**.


### 3) –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ –≤ —Ü–µ–ø–æ—á–∫–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π (`OrderHandler`) –æ–¥–∏–Ω –∏–∑ —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?

### –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

–¶–µ–ø–æ—á–∫–∞ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥—ã–π —É–∑–µ–ª (—Ö—ç–Ω–¥–ª–µ—Ä) –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –ø–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–ª—å—à–µ. –ù–æ —á—Ç–æ –µ—Å–ª–∏:

* –ø–µ—Ä–≤—ã–π —Ö—ç–Ω–¥–ª–µ—Ä –≤–æ–æ–±—â–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª?
* –∏–ª–∏ –≤—Ç–æ—Ä–æ–π ¬´—É–ø–∞–ª¬ª, –Ω–æ —Ç—Ä–µ—Ç–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω?

### –û—Ç–≤–µ—Ç

–í –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ *–∫–∞–∂–¥—ã–π —Ö—ç–Ω–¥–ª–µ—Ä —Å–∞–º —Ä–µ—à–∞–µ—Ç*, —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏:

* –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É,
* –µ–≥–æ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.

–û–±—ã—á–Ω–æ –µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç—ã:

1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑**
   –í–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É ‚Üí –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ü–µ–ø–æ—á–∫—É.

2. **–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–µ–±—è**
   –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É ‚Üí –≤—ã–∑–≤–∞—Ç—å `next.handle(ctx)`.

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback**
   –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–º–µ—á–∞—Ç—å –∑–∞–∫–∞–∑ –∫–∞–∫ ¬´—Ç—Ä–µ–±—É—é—â–∏–π —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏¬ª.

### –ß—Ç–æ –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

‚ùå —Ü–µ–ø–æ—á–∫–∞ **–Ω–µ –ø–µ—Ä–µ—Å–∫–∞–∫–∏–≤–∞–µ—Ç —Ö—ç–Ω–¥–ª–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**, –µ—Å–ª–∏ –æ–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.

–ï—Å–ª–∏ —Ö—ç–Ω–¥–ª–µ—Ä —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—Ä–æ–¥–∞), —Ç–æ –æ–Ω –¥–æ–ª–∂–µ–Ω *—Å–∞–º —Å–æ–æ–±—â–∏—Ç—å*, —á—Ç–æ –∑–∞–∫–∞–∑ –Ω–µ–ª—å–∑—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å.

---

## **4) –ú–æ–∂–µ—Ç –ª–∏ –±–∏–ª–¥–µ—Ä (`OrderBuilder`) —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –±–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö? –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç?**

### –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å

Builder –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∞–≥ –∑–∞ —à–∞–≥–æ–º. –ù–æ–≤–∏—á–æ–∫ –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ "–µ—Å–ª–∏ –∑–∞–±—ã—Ç—å —É–∫–∞–∑–∞—Ç—å shipping/buyer/items ‚Äî –≤—Å—ë —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞—Å—Ç—Å—è".

### –û—Ç–≤–µ—Ç

–ù–µ—Ç. –í `build()` –±–∏–ª–¥–µ—Ä –æ–±—è–∑–∞–Ω:

* –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
* –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç

–ò–Ω–∞—á–µ –∑–∞–∫–∞–∑ –ø–æ–ø–∞–¥—ë—Ç –≤ —Ü–µ–ø–æ—á–∫—É –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π –≤ ¬´–±–∏—Ç–æ–º¬ª —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –∏:

* –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤ –∑–∞–≤–∞–ª—è—Ç—Å—è,
* —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –º–æ–∂–µ—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º,
* —Å–∏—Å—Ç–µ–º–∞ –∑–∞–ø–∏—à–µ—Ç –∑–∞–∫–∞–∑ –≤ –ë–î, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å.

–¢–æ –µ—Å—Ç—å:
üëâ **Builder ‚Äî –ø–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∑–∞–∫–∞–∑–æ–º.**

---

## **5) –ß—Ç–æ —Å–ª—É—á–∏—Ç—Å—è, –µ—Å–ª–∏ —Ñ–∞–±—Ä–∏–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`ICategoryFamilyFactory`) –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø—Ä–æ–¥–∞–≤–µ—Ü —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–≤–∞—Ä —Å –Ω–æ–≤—ã–º category_code?**

### –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å

–°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∂—ë—Å—Ç–∫–æ —Å–≤—è–∑–∞–Ω–æ —Å —Ñ–∞–±—Ä–∏–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

### –û—Ç–≤–µ—Ç

`CategoryRegistry.getFactory()` –≤–µ—Ä–Ω—ë—Ç:

* –æ—à–∏–±–∫—É,
* –∏–ª–∏ `null` (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

* –°–∏—Å—Ç–µ–º–∞ **–Ω–µ —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç**.
* `ListingService` –Ω–µ —Å–º–æ–∂–µ—Ç —Å–æ–±—Ä–∞—Ç—å listing, —Ç–∞–∫ –∫–∞–∫ –Ω–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∞.
* –û—à–∏–±–∫–∞: *"unsupported category"*.

–ß—Ç–æ –≤–∞–∂–Ω–æ:

üëâ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç –º–æ–∂–Ω–æ **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ñ–∞–±—Ä–∏–∫–∏**.

–≠—Ç–æ –∑–∞–ª–æ–∂–µ–Ω–æ –∫–∞–∫ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏:
‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è ¬´–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é¬ª.

---

## **6) –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ `payments` —É—Å–ø–µ—à–Ω–æ —Å–ø–∏—à–µ—Ç –¥–µ–Ω—å–≥–∏, –Ω–æ `orders` –Ω–µ –æ–±–Ω–æ–≤–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–∞?**

### –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –Ω–µ—Ç.
–û–ø–ª–∞—Ç–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è.

### –û—Ç–≤–µ—Ç

–°–∏—Å—Ç–µ–º–∞ –æ–∫–∞–∂–µ—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏:

* –¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–Ω—ã,
* –∑–∞–∫–∞–∑ –æ—Å—Ç–∞—ë—Ç—Å—è `CreatedState`,
* –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –¥—É–º–∞–µ—Ç, —á—Ç–æ –∑–∞–∫–∞–∑ –Ω–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω,
* –¥–µ–Ω—å–≥–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É—à–ª–∏.

**–ö–∞–∫ —Ä–µ—à–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:**

1. `payments` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `PaymentCapturedEvent` –≤ `events`.
2. `events` –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ö—ç–Ω–¥–ª–µ—Ä.
3. –•—ç–Ω–¥–ª–µ—Ä –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –Ω–∞ `PaidState`.

–ï—Å–ª–∏ `orders` –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:

* event –∫–ª–∞–¥—ë—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å,
* —Ä–µ—Ç—Ä–∞–∏—Ç—Å—è –ø–æ–∫–∞ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è.

üëâ –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É **event-driven**, –∞ –Ω–µ ¬´–ø—Ä—è–º–æ–π RPC¬ª.

---

## **7) –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã —Ü–µ–Ω—ã (`Pricing`) –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ?**

### –ü—Ä–∏–º–µ—Ä

–ü–æ –∏–¥–µ–µ:

1. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–æ–º–æ–∫–æ–¥
2. –ü–æ—Ç–æ–º –Ω–∞–ª–æ–≥
3. –ü–æ—Ç–æ–º –ª–æ—è–ª—å–Ω–æ—Å—Ç—å

–ù–æ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –Ω–∞—Å–ª–æ–∏–ª –≤–æ—Ç —Ç–∞–∫:

```
LoyaltyDecorator(
    TaxDecorator(
        PromotionDecorator(
            BaseCalculator
        )
    )
)
```

### –û—Ç–≤–µ—Ç

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ü–µ–Ω—ã —Å–ª–æ–º–∞–µ—Ç—Å—è. –ù–∞–ø—Ä–∏–º–µ—Ä:

* —Å–∫–∏–¥–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å—Å—è –∫ —É–∂–µ –Ω–∞–ª–æ–≥–æ–≤–æ–π —Ü–µ–Ω–µ,
* –Ω–∞–ª–æ–≥ ‚Äî –∫ —É–º–µ–Ω—å—à–µ–Ω–Ω–æ–π —Ü–µ–Ω–µ,
* –±–æ–Ω—É—Å—ã ‚Äî –∫ —Ü–µ–Ω–µ —Å–æ —Å–∫–∏–¥–∫–æ–π, –∞ –¥–æ–ª–∂–Ω—ã ‚Äî –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π.

–í –∏—Ç–æ–≥–µ:

* –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–ø–ª–∞—á–∏–≤–∞–µ—Ç –∏–ª–∏ –ø–ª–∞—Ç–∏—Ç –º–µ–Ω—å—à–µ,
* —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ–≤–µ—Ä–Ω—ã,
* –æ—Ç—á—ë—Ç—ã –Ω–∞–ª–æ–≥–æ–≤–æ–π –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.

üëâ –í–∞–∂–Ω–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å **—Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤**:
–ª–∏–±–æ —á–µ—Ä–µ–∑:

* —Ñ–∞–±—Ä–∏–∫—É,
* –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é,
* —Ü–µ–ø–æ—á–∫—É –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è.

–ù–µ–ª—å–∑—è –ø–æ–∑–≤–æ–ª—è—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –≤—ã–±–∏—Ä–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤—Ä—É—á–Ω—É—é.

---

## **8) –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ `ListingRepositoryCacheProxy` —Ö—Ä–∞–Ω–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –ë–î —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞?**

### –ü–æ–¥–≤–æ–¥–Ω—ã–π –∫–∞–º–µ–Ω—å

–ö–µ—à ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –∏–ª–∏ –Ω–µ—Ç?

### –û—Ç–≤–µ—Ç

–°–µ–π—á–∞—Å –∫–µ—à ‚Äî —ç—Ç–æ **–∞–≥—Ä–µ–≥–∞—Ü–∏—è**, –∫–æ—Ç–æ—Ä–∞—è –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

`ListingRepositoryCacheProxy o-- ListingRepository`

–ó–Ω–∞—á–∏—Ç:

* –∫–µ—à ‚Äî –Ω–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã,
* –∏—Å—Ç–∏–Ω–∞ ‚Äî —Ç–æ–ª—å–∫–æ –ë–î.

–ï—Å–ª–∏ –∫–µ—à —É—Å—Ç–∞—Ä–µ–ª:

* –∫–ª–∏–µ–Ω—Ç —É–≤–∏–¥–∏—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –≤—ã–¥–∞—á–µ,
* –≤ –∫–æ—Ä–∑–∏–Ω–µ –ø–æ—è–≤–∏—Ç—Å—è —Å—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞,
* –ø—Ä–æ–¥–∞–≤–µ—Ü —É–≤–∏–¥–∏—Ç —Ç–æ–≤–∞—Ä –∫–∞–∫ ¬´–∞–∫—Ç–∏–≤–Ω—ã–π¬ª, —Ö–æ—Ç—è –æ–Ω —É–¥–∞–ª—ë–Ω,
* –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ/—Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—é –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω–æ.

### –ö–∞–∫ —Ä–µ—à–∞—Ç—å:

* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞)
* –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–µ—à –ø—Ä–∏ `repository.save()`
* –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `events` –∏ —á–∏—Å—Ç–∏—Ç—å –∫–µ—à
